# OxyGent 多智能体协作系统项目介绍

## 1. 项目简介

OxyGent 是一个基于多智能体协作系统（MAS）的智能体调配平台，通过专业智能体的分工协作，实现对复杂任务的高效处理。系统采用主从架构设计，由主智能体协调多个专业子智能体，每个智能体专注于特定领域的能力，通过 MCP（Model Context Protocol）工具集成扩展功能。

**核心设计理念**：将复杂任务分解为专业子任务，由相应领域的智能体处理，最后整合结果返回用户，实现"专业的人做专业的事"的协作模式。

## 2. 智能体架构设计

### 2.1 主从架构
```
用户请求 → master_agent（主智能体） → 智能体路由 → 专业智能体 → MCP工具 → 执行任务
       ↑                                                                 ↓
        ← 结果整合 ← 智能体协作 ← 子任务分解 ←
```

### 2.2 智能体类型
- **协调型智能体**：master_agent，负责任务分发、结果整合
- **专业型智能体**：file_agent、command_agent、search_agent、RAG_agent 等
- **工具型智能体**：通过 MCP 工具提供基础能力

### 2.3 通信机制
- **任务委托**：主智能体根据任务类型选择合适的专业智能体
- **结果传递**：专业智能体完成任务后返回结果给主智能体
- **错误处理**：智能体失败时尝试备用方案或请求用户澄清

## 3. 核心智能体详解

### 3.1 master_agent（主智能体）
**职责**：用户对话接口、任务分析、智能体调度、结果整合

**关键特性**：
- 唯一用户对话接口，隐藏内部智能体复杂性
- 智能任务路由，根据用户意图选择合适专业智能体
- 结果整合与格式化，提供统一的用户体验
- 错误处理与重试机制

**配置示例**（来自 start_page.py）：
```python
oxy.ReActAgent(
    is_master=True,
    name="master_agent",
    prompt=提示词.prompt_of_master,
    sub_agents=["RAG_agent", "file_agent", "search_agent", "command_agent"],
)
```

### 3.2 file_agent（文件智能体）
**职责**：文件读取、目录管理、内容分析、缓存文件处理

**能力范围**：
- 读取各种格式的文件内容
- 列出目录结构和文件信息
- 分析文件内容（文本、代码、数据等）
- 管理 cache_dir 下的各类缓存文件

**工具依赖**：file_reader MCP 工具

**提示词重点**：强调对 cache_dir 目录下文件的自由使用，包括用户上传、网络下载、预置资源等

### 3.3 command_agent（命令智能体）
**职责**：命令执行、代码编写与运行、系统操作

**能力范围**：
- 执行系统命令和脚本
- 编写并运行 Python 代码
- 处理命令行输出
- 批量任务执行

**工具依赖**：command_handler MCP 工具（SSE 传输）

**提示词重点**：强调通过编写代码文件再执行的方式，避免直接运行不可靠的命令

### 3.4 search_agent（搜索智能体）
**职责**：互联网搜索、实时信息获取、技术文档查询、网络资源下载

**能力范围**：
- 关键词搜索与结果筛选
- 时间敏感信息的时效性保证
- 多源信息对比与验证
- 搜索结果摘要与整理

**工具依赖**：web_search download_file工具

**提示词特点**：严格的 JSON 输出格式，专注于搜索策略优化

### 3.5 RAG_agent（检索增强生成智能体）
**职责**：知识库查询、文档检索、信息验证

**能力范围**：
- 向量数据库查询
- 文档相似性搜索
- 上下文增强回答
- 多文档信息整合

**工具依赖**：RAG_server MCP 工具

## 4. 智能体调配策略

### 4.1 任务路由机制
系统根据用户请求的关键词和上下文自动选择最合适的智能体：

1. **文件相关请求** → file_agent
   - 关键词：文件、读取、目录、内容问答、上传
   - 示例："读取 cache_dir/uploads 下的最新文件"

2. **代码/命令相关请求** → command_agent
   - 关键词：运行、执行、代码、命令、脚本、Python
   - 示例："编写一个 Python 脚本计算斐波那契数列"

3. **搜索相关请求** → search_agent
   - 关键词：搜索、查找、最新、新闻、技术、文档
   - 示例："查找最新的 Python 3.12 特性"

4. **知识库查询** → RAG_agent
   - 关键词：知识库、文档、资料、查询、检索
   - 示例："查询关于机器学习的基础知识"

5. **复杂/综合请求** → master_agent 协调多智能体
   - 示例："搜索最新的 AI 新闻，下载相关文章并分析内容"

### 4.2 协作工作流
对于复杂任务，智能体间通过以下流程协作：

```python
# 示例：下载网络资源并分析内容
1. 用户请求："下载 https://example.com/article 并总结内容"
2. master_agent 识别为复合任务
3. 调用 search_agent 获取网页内容（或直接下载）
4. 内容保存到 cache_dir/net_store
5. 调用 file_agent 读取下载的文件
6. 调用 RAG_agent 或直接由 master_agent 总结内容
7. 整合结果返回用户
```

### 4.3 错误处理策略
- **智能体失败**：尝试备用智能体或降级方案
- **工具异常**：返回详细错误信息，提示用户调整请求
- **资源不足**：清理缓存或建议用户提供更多资源
- **超时处理**：设置合理的超时时间，避免无限等待

## 5. MCP工具集成

### 5.1 工具架构
系统通过 MCP 协议集成多种工具，扩展智能体能力：

```
智能体 → MCP客户端 → MCP服务器 → 实际功能
           ↓
     SSE/Stdio 传输
```

### 5.2 核心工具列表
| 工具名称        | 通信方式 | 功能描述           | 服务智能体    |
| --------------- | -------- | ------------------ | ------------- |
| file_reader     | Stdio    | 文件读取与目录管理 | file_agent    |
| command_handler | SSE      | 命令执行与代码运行 | command_agent |
| RAG_server      | Stdio    | 知识库检索与查询   | RAG_agent     |
| search_server   | Stdio    | 互联网搜索         | search_agent  |


## 6. 配置与管理



### 6.1 提示词管理
系统采用集中式提示词管理（提示词.py）：

**设计原则**：
1. **分离关注点**：提示词与代码分离，便于维护
2. **专业化设计**：每个智能体有针对性提示词
3. **持续优化**：根据实际表现调整提示词
4. **安全考虑**：避免敏感信息泄露

**关键提示词要素**：
- 角色定义：明确智能体职责
- 工具使用规范：JSON 格式要求
- 错误处理指导：如何应对异常
- 输出格式：确保一致性

### 6.2 资源管理（cache_dir）
统一的资源管理目录结构：

```
cache_dir/
├── uploads/      # 用户上传资源
├── net_store/    # 网络下载资源
├── pre_stored/   # 预置资源
└── generate/     # 生成文件
```

**管理策略**：
- 智能体可自由使用 cache_dir 下所有文件
- 自动清理机制防止空间不足
- 文件类型识别与适当处理
- 权限控制与安全考虑

### 6.3 环境配置
- **env.py**：API 密钥、模型配置等敏感信息
- **config.json**：系统参数、日志配置、服务器设置
- **requirements.txt**：依赖包管理

## 7. 快速开始

### 7.1 环境准备
```bash
# 克隆项目
git clone <repository-url>
cd OxyGent

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
cp env.example.py env.py
# 编辑 env.py 设置 API 密钥等
```

### 7.2 启动智能体系统
```bash
# 启动 MCP 服务器（根据需要）
cd mcp_servers
uv run file_reader.py &
uv run RAG_server.py &

# 启动主系统
cd ..
python start_page.py
```

### 7.3 基础使用示例

**示例 1：文件操作**
```
用户：读取 cache_dir/uploads 下的最新文件
系统：file_agent → file_reader → 返回文件内容
```

**示例 2：代码执行**
```
用户：编写一个计算阶乘的 Python 函数并测试
系统：command_agent → command_handler → 编写代码 → 执行 → 返回结果
```

**示例 3：网络搜索**
```
用户：搜索最新的机器学习论文
系统：search_agent → web_search → 返回搜索结果
```

**示例 4：复杂任务**
```
用户：下载 Python 官方文档并总结新特性
系统：
1. master_agent 分析任务
2. search_agent 搜索并下载文档
3. file_agent 读取下载的文件
4. RAG_agent 或 master_agent 总结内容
5. 返回整合结果
```

## 8. 高级应用

### 8.1 自定义智能体开发
1. **确定职责**：明确智能体的专业领域
2. **设计提示词**：在提示词.py中添加专用提示词
3. **配置工具**：分配相应的 MCP 工具
4. **集成到系统**：添加到 oxy_space 和 master_agent 的 sub_agents

### 8.2 复杂工作流设计
对于需要多智能体协作的复杂任务：

```python
# 设计思路
1. 任务分解：将复杂任务拆解为原子任务
2. 智能体分配：每个原子任务分配给最合适的智能体
3. 依赖管理：确定任务间的依赖关系
4. 结果整合：设计结果合并策略
5. 错误处理：制定各环节的异常处理方案
```

### 8.3 性能优化建议
1. **智能体缓存**：重复任务结果缓存
2. **并行处理**：独立任务并行执行
3. **资源复用**：共享连接和资源
4. **负载均衡**：避免单个智能体过载
5. **监控调优**：根据日志调整配置

### 8.4 调试与监控
- **日志系统**：详细记录智能体决策过程
- **性能指标**：响应时间、成功率、工具使用统计
- **错误追踪**：智能体失败原因分析
- **用户反馈**：根据实际使用优化提示词




---


